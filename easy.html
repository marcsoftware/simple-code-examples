<!-- in this mode user presses space key and has to retype from memory-->
<!DOCTYPE html>
<html>

<meta charset="UTF-8">
<style>

.space{
  padding-top:100px;
}
#header{
  
  
  margin-top: 0px;
}
    div{
        margin: auto;
  width: 80%;
  border: 3px solid white;
  padding: 10px;
    }


    input{
      width:90%;
    }

    #left{

      color:green;
      display:inline;
      background-color: white;
      padding-right: 0px;
      margin-right: :0px;
      font-weight: bold;

    }

    #middle{
      color:white;
      display:inline;
      background-color: #121212;
      padding-right: 0px;
      margin-right: :0px;
      animation: blinker 1s linear infinite;

    }

    #right{
      display:inline;  
    }

@keyframes blinker {
  50% {
    opacity: 0;
  }

  

    pre{
      display:inline;
      float:left;
    }
    #context{
      color:grey;
    }


    #feedback{
      /*correct*/
      background-color: #121212;
      color:white;
      

    }

    .wrong{
      color:red;
      background-color: white;
    }

    #ans_key{
      margin-top: 5px;
      padding:5px;
      color:red;
    }
</style>
<body>



 <script src="lib.js"></script> 

<script>

//-----------------------------------------------------------------------------
// global variables
//-----------------------------------------------------------------------------    

 file='x';
 ans_key = '';
 var file_name;
 window.onload=init;
//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
   
function init() {
  
  const queryString = window.location.search;
  

  const urlParams = new URLSearchParams(queryString);
  
   file_name = (urlParams+"").split("=")[1];
  document.title=file_name;

  page=parseInt(getCookie(`${file_name}easy`));

  doGet(file_name);

  
}



//-----------------------------------------------------------------------------
// draw the question
//-----------------------------------------------------------------------------
var page;
function parseFile(x){
        document.getElementById('right').innerHTML=x;
        x=document.getElementById('right').innerHTML;

    document.getElementById("page").innerHTML=(page+1)+"/"+x.length; //
    var max = x.length;

    if(page>max){
      page=max;
      setCookie(page);
    }
    

    var org =x;
    x=x.slice((page+1)*-1); // negatives numbers will get end of X
    
    if(x.length<10){
      page=max;
      setCookie(page);
    }
    
      document.getElementById('middle').innerHTML=" ";
    document.getElementById('right').innerHTML=x.trim();
     
}




//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
 async  function doGet(url) {

     url = "study_material/"+url;
    if(url.includes(".java")){

    }else{
        url+='.txt';
    }


   url=url.replace(/%2F/g,"/");
   
      let response = await fetch(url);

   
   

    if (response.status === 200) {
        let data = await response.text();
         file = data.split("\n"); 
         //file.shift();// shift() deletes the empty element.
        
        parseFile(data);
  
        // handle data
    }
}



//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function compare(left,right){
  left=left.toLowerCase();
  right=right.toLowerCase();
    if(left==='`SKIP'){ //let user skip a line.
        return true;
    }
    left=left.replace(/\s/g,"");
    right=right.replace(/\s/g,"");


    
    left=left.toLowerCase().trim();
    right=right.toLowerCase().trim();
    return left === right;
}


//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function checkInput(event,input){
  
       var unicode=  event.keyCode;
       var ch = String.fromCharCode(unicode);
       
       input=ch;
       
       
      var middle = document.getElementById('middle').innerHTML.replace(/&gt;/g,">").replace(/&lt;/g,"<");
      var newlineflag=false;
      if(middle.length !== 0){
        middle=middle[0];

      }
      if(middle.toLowerCase()===input.toLowerCase() || middle.length===0 || middle.trim().length===0 ){
          document.getElementById('input').value='';

      }else if(middle.includes('↲') && input.match(/\s/g)!==null){

      }else{
        return;
      }
      moveLetter();
      setCookie(document.getElementById('right').innerHTML.length);
      document.getElementById('input').value='';



}


//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function moveLetter(){
    var middle = document.getElementById('middle').innerHTML;
    if(middle.includes('↲')){
      middle="\n";
    }
    document.getElementById('left').innerHTML+=middle;  

    var right = document.getElementById('right').innerHTML.replace(/&gt;/g,">").replace(/&lt;/g,"<");

    // if right[0] is line break convert to space.
    var target = right[0];
    if(right[0].match(/\n/g) !==null){   
      
      target="↲\n";
    }
    document.getElementById('middle').innerHTML=target;

    
    document.getElementById('right').innerHTML=right.slice(1);
    document.getElementById("page").innerHTML=right.length--;

}

//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function getCookie(cname) {
  var p = localStorage.getItem(`${file_name}easy`); 
  
  if( p==='NaN' || !p){
    
    p=0;
  }
  return p;
  //localStorage.setItem(`${book_name}lineNumber`,pageNumber*PAGE_SIZE );

}

//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function setCookie(x) {

  localStorage.setItem(`${file_name}easy`,x);

}




</script>
<div id='header'>

  <span id='page'></span><span id='que'></span><progress id="bar" value="0" max="25"> 32% </progress><br/>
  <input type="text" id='input'  onkeypress='checkInput(event,this.value)'/> <br/>

</div>

<pre id='left'></pre><pre id='middle'></pre><pre id='right'></pre>




</body>
</html>

