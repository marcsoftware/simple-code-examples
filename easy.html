<!-- in this mode user presses space key and has to retype from memory-->
<!DOCTYPE html>
<html>

<meta charset="UTF-8">
<style>
    div{
        margin: auto;
  width: 80%;
  border: 3px solid white;
  padding: 10px;
    }


    input{
      width:90%;
    }

    #typed{
      color:lightgreen;
      display:inline;
      background-color: #121212;
      padding-right: 0px;
      margin-right: :0px;
    }

    pre{
      display:inline;
    }
    #context{
      color:grey;
    }


    #feedback{
      /*correct*/
      background-color: #121212;
      color:white;
      

    }

    .wrong{
      color:red;
      background-color: white;
    }

    #ans_key{
      margin-top: 5px;
      padding:5px;
      color:red;
    }
</style>
<body>



 <script src="lib.js"></script> 

<script>

//-----------------------------------------------------------------------------
// global variables
//-----------------------------------------------------------------------------    

 file='x';
 ans_key = '';
 var file_name;
 window.onload=init;
//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
   
function init() {
  const queryString = window.location.search;
  console.log(queryString);

  const urlParams = new URLSearchParams(queryString);
  
   file_name = (urlParams+"").split("=")[1];
  document.title=file_name;

  page=parseInt(getCookie("page"));
  doGet(file_name);


  
 
 
  
}



//-----------------------------------------------------------------------------
// draw the question
//-----------------------------------------------------------------------------
var page;
function parseFile(x){
    
    
    document.getElementById("page").innerHTML=(page+1)+"/"+x.length;

    
      
    x=x.slice(page*-1);
     document.getElementById('data').innerHTML=x.trim();
}




//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
 async  function doGet(url) {

     url = "study_material/"+url;
    if(url.includes(".java")){

    }else{
        url+='.txt';
    }


   url=url.replace(/%2F/g,"/");
   console.log(url);
      let response = await fetch(url);

    console.log(response.status); // 200
    console.log(response.statusText); // OK

    if (response.status === 200) {
        let data = await response.text();
         file = data.split("\n"); 
         //file.shift();// shift() deletes the empty element.
        
        parseFile(data);

  
        // handle data
    }
}



//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function compare(left,right){
  left=left.toLowerCase();
  right=right.toLowerCase();
    if(left==='`SKIP'){ //let user skip a line.
        return true;
    }
    left=left.replace(/\s/g,"");
    right=right.replace(/\s/g,"");


    
    left=left.toLowerCase().trim();
    right=right.toLowerCase().trim();
    return left === right;
}


//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function checkInput(input){
 

  if(input===''){
    return;
  }else{
    input=input.replace(/\s/g,'')
  }
   var letter=input;
   var text = document.getElementById('data').innerHTML;



   if(letter.toLowerCase().includes(text[0].toLowerCase()    ) || input==='`' ) {
      document.getElementById('input').value='';
      moveLetter();

      if(text[1].match(/\s/g)){
        moveLetter();
      }

      setCookie(document.getElementById('data').innerHTML.length);
   }else{

   }

}


//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function moveLetter(){
    var x = document.getElementById('data').innerHTML;
    document.getElementById('typed').innerHTML+=x[0];  
    document.getElementById('data').innerHTML=x.slice(1);

}

//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function getCookie(cname) {
  var p = localStorage.getItem(`${file_name}easy`); 
  
  if( p==='NaN' || !p){
    
    p=0;
  }
  return p;
  //localStorage.setItem(`${book_name}lineNumber`,pageNumber*PAGE_SIZE );

}

//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
function setCookie(x) {
  localStorage.setItem(`${file_name}easy`,x);

}






</script>
<div>

<span id='page'></span><span id='que'></span><progress id="bar" value="0" max="25"> 32% </progress><br/>

<br/>
<input type="text" id='input' onkeydown='checkInput(this.value)' onkeyup='checkInput(this.value)'/> <br/>
<pre id='typed'></pre>
<pre id='data'></pre>

<span id='color'></span>
<div id='context'>x</div>
</div>
</body>
</html>

